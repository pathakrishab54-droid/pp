<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Birthday Timeline</title>
<style>
    :root {
        --bg-root: #050203;
        --card-bg: #120a0c;
        --accent: #ff2e63; /* Vibrant Pink/Red */
        --text: #ffffff;
        --text-dim: #bbaabb;
        --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

    body {
        margin: 0; padding: 0;
        background-color: var(--bg-root);
        background-image: radial-gradient(circle at 50% 0%, #330815 0%, #000000 100%);
        color: var(--text);
        font-family: var(--font-main);
        min-height: 100vh;
        display: flex; flex-direction: column;
        padding-bottom: 90px; /* Space for nav bar */
    }

    /* --- HEADER --- */
    header {
        position: sticky; top: 0; z-index: 100;
        background: rgba(5,2,3, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding: 15px 20px;
        display: flex; justify-content: space-between; align-items: center;
    }
    .logo { font-weight: 800; font-size: 1.1rem; letter-spacing: 1px; color: var(--accent); }
    .btn-gear { background: none; border: none; color: var(--text-dim); cursor: pointer; padding: 5px; }
    .btn-gear svg { width: 24px; height: 24px; fill: currentColor; }

    /* --- MAIN CARD AREA --- */
    .main-stage {
        flex: 1;
        width: 100%; max-width: 600px; margin: 0 auto;
        padding: 20px;
        display: flex; flex-direction: column;
    }

    .card {
        background: var(--card-bg);
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 24px;
        position: relative;
        overflow: hidden; /* contain the blur */
        min-height: 500px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        transition: transform 0.2s ease;
    }

    /* --- CONTENT (Underneath) --- */
    .card-content {
        padding: 30px 25px;
        opacity: 1;
        transition: opacity 0.5s;
    }
    
    /* Slot Info */
    .slot-badge {
        display: inline-block;
        background: rgba(255, 46, 99, 0.15);
        color: var(--accent);
        font-size: 0.7rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
        padding: 6px 12px; border-radius: 20px;
        margin-bottom: 20px;
    }

    /* Media Box */
    .media-frame {
        width: 100%; border-radius: 16px; overflow: hidden;
        background: #000; margin-bottom: 25px;
        border: 1px solid rgba(255,255,255,0.1);
    }
    .media-frame img { width: 100%; height: auto; display: block; }
    .media-frame iframe, .media-frame video { width: 100%; aspect-ratio: 16/9; border: 0; display: block; }

    /* Text Content */
    .story-h1 { font-size: 2rem; font-weight: 800; margin: 0 0 15px 0; line-height: 1.1; }
    .story-p { font-size: 1.1rem; line-height: 1.7; color: #e0e0e0; white-space: pre-line; margin-bottom: 20px; }
    .story-emoji { font-size: 3rem; text-align: center; display: block; margin-top: 30px; }

    /* --- LOCK OVERLAY (The Blur) --- */
    .lock-screen {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(10, 5, 7, 0.85); /* Dark overlay */
        backdrop-filter: blur(30px); /* Heavy Blur */
        -webkit-backdrop-filter: blur(30px);
        z-index: 50;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        text-align: center;
        padding: 20px;
        transition: opacity 0.4s;
    }
    /* Class to remove lock */
    .lock-screen.unlocked { opacity: 0; pointer-events: none; backdrop-filter: none; }

    .lock-icon { width: 60px; height: 60px; color: var(--accent); margin-bottom: 15px; }
    .lock-timer { font-size: 2.5rem; font-weight: 700; font-variant-numeric: tabular-nums; margin-bottom: 5px; text-shadow: 0 0 20px var(--accent); }
    .lock-msg { color: var(--text-dim); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }

    /* --- ADMIN EDIT BUTTON --- */
    .admin-bar {
        background: rgba(255, 46, 99, 0.1); border-bottom: 1px solid var(--accent);
        padding: 10px; text-align: center;
        display: none; /* Hidden by default */
    }
    .admin-btn {
        background: var(--accent); color: #fff; border: none; padding: 8px 20px;
        border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 0.85rem;
    }
    body.is-admin .admin-bar { display: block; }

    /* --- NAVIGATION --- */
    .nav-dock {
        position: fixed; bottom: 0; left: 0; width: 100%;
        background: rgba(5,2,3, 0.95); border-top: 1px solid rgba(255,255,255,0.15);
        padding: 15px 25px;
        display: flex; justify-content: space-between; align-items: center;
        z-index: 90;
    }
    .nav-btn {
        background: rgba(255,255,255,0.1); color: #fff; border: none;
        height: 44px; padding: 0 24px; border-radius: 22px;
        font-weight: 600; font-size: 1rem; cursor: pointer; transition: 0.2s;
    }
    .nav-btn:disabled { opacity: 0.3; cursor: default; }
    .nav-btn:active:not(:disabled) { transform: scale(0.95); background: var(--accent); }
    .page-num { font-weight: 700; color: var(--text-dim); font-size: 0.9rem; }

    /* --- MODALS --- */
    .modal-overlay {
        position: fixed; top:0; left:0; width:100%; height:100%;
        background: rgba(0,0,0,0.92); z-index: 200;
        display: flex; align-items: center; justify-content: center;
        opacity: 0; pointer-events: none; transition: 0.3s;
    }
    .modal-overlay.active { opacity: 1; pointer-events: auto; }
    .modal {
        width: 90%; max-width: 450px; background: #181012;
        border: 1px solid #333; border-radius: 20px; padding: 25px;
        box-shadow: 0 20px 50px #000;
        max-height: 85vh; overflow-y: auto;
    }
    .inp-group { margin-bottom: 15px; }
    .inp-label { display: block; color: var(--text-dim); margin-bottom: 6px; font-size: 0.85rem; }
    .inp-field { width: 100%; padding: 12px; background: #080405; border: 1px solid #444; color: #fff; border-radius: 8px; }
    .inp-field:focus { border-color: var(--accent); }
    
    .btn-prime { width: 100%; background: var(--accent); color: #fff; border: none; padding: 12px; border-radius: 10px; font-weight: bold; font-size: 1rem; cursor: pointer; }
    .btn-sub { width: 100%; background: transparent; border: 1px solid #444; color: #ccc; padding: 12px; border-radius: 10px; margin-top: 10px; cursor: pointer; }

    /* Confetti */
    #confetti-canvas { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:150; }
</style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<header>
    <div class="logo">BIRTHDAY TIMELINE</div>
    <button class="btn-gear" id="settings-trigger">
        <svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.06-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.85,11.36,4.8,11.68,4.8,12s0.05,0.64,0.09,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
    </button>
</header>

<div class="main-stage">
    <div class="card" id="story-card">
        
        <!-- ADMIN ONLY BAR -->
        <div class="admin-bar">
            <button class="admin-btn" id="btn-edit-current">‚úèÔ∏è Edit Page</button>
        </div>

        <!-- LOCK SCREEN (BLUR) -->
        <div class="lock-screen" id="lock-overlay">
            <svg class="lock-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>
            <div class="lock-timer" id="countdown">--:--:--</div>
            <div class="lock-msg" id="lock-msg">LOCKED UNTIL 21st</div>
        </div>

        <!-- ACTUAL CONTENT -->
        <div class="card-content">
            <div class="slot-badge" id="display-time">00:00 AM</div>
            
            <div class="media-frame" id="display-media">
                <!-- Image or Video goes here -->
            </div>

            <h1 class="story-h1" id="display-title">Title</h1>
            <div class="story-p" id="display-text">Message...</div>
            <div class="story-emoji" id="display-emoji">‚ù§Ô∏è</div>
        </div>
    </div>
</div>

<!-- NAVIGATION -->
<nav class="nav-dock">
    <button class="nav-btn" id="nav-prev">‚Üê Prev</button>
    <span class="page-num" id="nav-indicator">1 / 8</span>
    <button class="nav-btn" id="nav-next">Next ‚Üí</button>
</nav>

<!-- LOGIN MODAL -->
<div class="modal-overlay" id="mod-login">
    <div class="modal">
        <h2>Editor Access</h2>
        <div class="inp-group">
            <label class="inp-label">Password</label> <!-- HINT REMOVED -->
            <input type="password" id="inp-pass" class="inp-field" placeholder="Enter passphrase">
        </div>
        <button class="btn-prime" id="btn-unlock">Login</button>
        <button class="btn-sub" onclick="closeModals()">Cancel</button>
    </div>
</div>

<!-- EDITOR MODAL -->
<div class="modal-overlay" id="mod-editor">
    <div class="modal">
        <h2>Edit Page <span id="edit-num"></span></h2>
        <form id="editor-form">
            <div class="inp-group">
                <label class="inp-label">Title</label>
                <input type="text" id="edit-title" class="inp-field">
            </div>
            <div class="inp-group">
                <label class="inp-label">Message</label>
                <textarea id="edit-text" class="inp-field" rows="4"></textarea>
            </div>
            
            <div style="background:#000; padding:15px; border-radius:10px; border:1px solid #333; margin-bottom:15px;">
                <label class="inp-label" style="color:var(--accent)">MEDIA (Select One)</label>
                
                <label class="inp-label" style="margin-top:10px;">A: Upload Photo</label>
                <input type="file" id="edit-file" class="inp-field" accept="image/*">
                
                <div style="text-align:center; margin:10px; color:#666; font-size:0.8rem;">‚Äî OR ‚Äî</div>
                
                <label class="inp-label">B: Video Link (YouTube/MP4)</label>
                <input type="text" id="edit-vid" class="inp-field" placeholder="Paste link here...">
            </div>

            <div class="inp-group">
                <label class="inp-label">Emoji</label>
                <input type="text" id="edit-emoji" class="inp-field">
            </div>
            
            <button type="submit" class="btn-prime">Save Changes</button>
            <button type="button" class="btn-sub" onclick="closeModals()">Cancel</button>
        </form>
    </div>
</div>

<!-- ADMIN TOOLS MODAL -->
<div class="modal-overlay" id="mod-tools">
    <div class="modal">
        <h2>Settings</h2>
        <button class="btn-sub" id="btn-reset" style="color:#ff4444; border-color:#ff4444;">‚ö†Ô∏è Reset All Data</button>
        <button class="btn-sub" onclick="closeModals()">Close</button>
    </div>
</div>

<script>
/*
    --- CONFIGURATION ---
    Change TARGET_DATE to your actual event date (YYYY-MM-DD).
    The hours array represents 00:00, 03:00, etc. on that specific date.
*/
const CONFIG = {
    TARGET_DATE: "2025-11-21", // <--- CHANGE THIS IF NEEDED
    HOURS: [0, 3, 6, 9, 12, 15, 18, 21],
    PASSWORD: "love",
    KEY: "bday_v7_strict"
};

const DEFAULTS = [
    { title: "The Beginning", text: "Midnight strikes. The day is yours.", emoji: "üåô" },
    { title: "Sweet Dreams", text: "Sleep peacefully...", emoji: "üí§" },
    { title: "Rise & Shine", text: "Good morning sunshine!", emoji: "üåÖ" },
    { title: "Morning Fuel", text: "Time for coffee?", emoji: "‚òï" },
    { title: "Halfway", text: "Noon check-in.", emoji: "‚òÄÔ∏è" },
    { title: "Afternoon", text: "Thinking of you...", emoji: "‚ù§Ô∏è" },
    { title: "Evening", text: "Time to unwind.", emoji: "üç∑" },
    { title: "Grand Finale", text: "A special ending.", emoji: "üé¨" }
];

let state = {
    pages: [],
    idx: 0,
    isAdmin: false
};

function init() {
    // Load Data
    const raw = localStorage.getItem(CONFIG.KEY);
    state.pages = raw ? JSON.parse(raw) : DEFAULTS.map((d,i) => ({...d, id:i, img:null, vid:null}));
    
    // Default to start page based on time, but don't unlock if date is wrong
    const now = new Date();
    const h = now.getHours();
    let start = 0;
    // Only auto-advance index if we are ON or AFTER the target date
    const targetDateObj = new Date(CONFIG.TARGET_DATE);
    const isTodayOrLater = now >= targetDateObj; 
    
    if (isTodayOrLater) {
        for(let i=0; i<CONFIG.HOURS.length; i++) {
            if (h >= CONFIG.HOURS[i]) start = i;
        }
    }
    
    state.idx = start;

    setupEvents();
    render();
    setInterval(tick, 1000);
}

// Calculate the exact Unlock Date object
function getUnlockTime(index) {
    const t = new Date(CONFIG.TARGET_DATE + "T00:00:00"); // Start of target day
    t.setHours(CONFIG.HOURS[index]);
    return t;
}

function render() {
    const p = state.pages[state.idx];
    const unlockTime = getUnlockTime(state.idx);
    const now = new Date();

    // STRICT LOCK LOGIC: 
    // Locked if (Current Time < Unlock Time) AND (User is NOT Admin)
    const isLocked = (now < unlockTime) && !state.isAdmin;

    // 1. UI Updates (Content always loads underneath)
    document.getElementById('nav-indicator').innerText = `${state.idx + 1} / 8`;
    document.getElementById('nav-prev').disabled = (state.idx === 0);
    document.getElementById('nav-next').disabled = (state.idx === 7);

    document.getElementById('display-time').innerText = `PAGE ${state.idx+1} ‚Ä¢ ${unlockTime.toLocaleTimeString([],{hour:'numeric', minute:'2-digit'})}`;
    document.getElementById('display-title').innerText = p.title;
    document.getElementById('display-text').innerText = p.text;
    document.getElementById('display-emoji').innerText = p.emoji;

    // 2. Media
    const mBox = document.getElementById('display-media');
    mBox.innerHTML = '';
    if (p.vid) mBox.innerHTML = processVideo(p.vid);
    else if (p.img) {
        const img = document.createElement('img'); img.src = p.img; mBox.appendChild(img);
    }

    // 3. Lock Overlay Logic
    const overlay = document.getElementById('lock-overlay');
    const lockMsg = document.getElementById('lock-msg');
    
    if (isLocked) {
        overlay.classList.remove('unlocked'); // Show blur
        lockMsg.innerText = `UNLOCKS ${CONFIG.TARGET_DATE} AT ${unlockTime.toLocaleTimeString([],{hour:'numeric', minute:'2-digit'})}`;
        window.scrollTo(0,0);
    } else {
        overlay.classList.add('unlocked'); // Hide blur
        if (!p.seen && !state.isAdmin) {
            p.seen = true;
            localStorage.setItem(CONFIG.KEY, JSON.stringify(state.pages));
            fireConfetti();
        }
    }

    // 4. Admin Class
    document.body.classList.toggle('is-admin', state.isAdmin);
}

function tick() {
    // Updates countdown on lock screen
    const overlay = document.getElementById('lock-overlay');
    if (!overlay.classList.contains('unlocked')) {
        const target = getUnlockTime(state.idx).getTime();
        const now = new Date().getTime();
        const diff = target - now;

        if (diff <= 0) {
            render(); // Unlock triggered!
        } else {
            const h = Math.floor(diff / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);
            // Format roughly
            const days = Math.floor(h / 24);
            const remH = h % 24;
            
            if (days > 0) {
                document.getElementById('countdown').innerText = `${days}d ${remH}h ${m}m`;
            } else {
                document.getElementById('countdown').innerText = `${remH}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }
        }
    }
}

function processVideo(url) {
    if(url.includes('<iframe') || url.includes('<video')) return url;
    if(url.includes('youtu')) {
        const id = url.match(/(?:v=|\/)([\w-]{11})/);
        if(id) return `<iframe src="https://www.youtube.com/embed/${id[1]}" allowfullscreen></iframe>`;
    }
    if(url.endsWith('.mp4')) return `<video src="${url}" controls playsinline></video>`;
    return `<iframe src="${url}"></iframe>`;
}

function fireConfetti() {
    const c = document.getElementById('confetti-canvas'); const ctx = c.getContext('2d');
    c.width = window.innerWidth; c.height = window.innerHeight;
    const p = Array.from({length:80}).map(()=>({x:c.width/2, y:c.height/2, vx:(Math.random()-0.5)*15, vy:(Math.random()-0.5)*15-5, c:`hsl(${Math.random()*360},100%,60%)`}));
    let f=0;
    function loop() {
        ctx.clearRect(0,0,c.width,c.height);
        p.forEach(pt=>{ pt.x+=pt.vx; pt.y+=pt.vy; pt.vy+=0.4; ctx.fillStyle=pt.c; ctx.fillRect(pt.x,pt.y,6,6); });
        if(f++<100) requestAnimationFrame(loop); else ctx.clearRect(0,0,c.width,c.height);
    }
    loop();
}

function setupEvents() {
    // Nav
    document.getElementById('nav-prev').onclick = () => { if(state.idx>0){state.idx--; render(); window.scrollTo(0,0);} };
    document.getElementById('nav-next').onclick = () => { if(state.idx<7){state.idx++; render(); window.scrollTo(0,0);} };

    // Settings
    document.getElementById('settings-trigger').onclick = () => {
        state.isAdmin ? openModal('mod-tools') : openModal('mod-login');
    };

    // Login
    document.getElementById('btn-unlock').onclick = () => {
        if(document.getElementById('inp-pass').value === CONFIG.PASSWORD) {
            state.isAdmin = true;
            closeModals();
            render();
            alert("Editor Unlocked: Blur removed.");
        } else alert("Wrong Password");
    };

    // Reset
    document.getElementById('btn-reset').onclick = () => {
        if(confirm("Erase all data?")) { localStorage.removeItem(CONFIG.KEY); location.reload(); }
    };

    // Edit Page
    document.getElementById('btn-edit-current').onclick = () => {
        const p = state.pages[state.idx];
        document.getElementById('edit-num').innerText = state.idx + 1;
        document.getElementById('edit-title').value = p.title;
        document.getElementById('edit-text').value = p.text;
        document.getElementById('edit-emoji').value = p.emoji;
        document.getElementById('edit-vid').value = '';
        document.getElementById('edit-file').value = '';
        openModal('mod-editor');
    };

    // Save
    document.getElementById('editor-form').onsubmit = (e) => {
        e.preventDefault();
        const p = state.pages[state.idx];
        p.title = document.getElementById('edit-title').value;
        p.text = document.getElementById('edit-text').value;
        p.emoji = document.getElementById('edit-emoji').value;
        
        const vid = document.getElementById('edit-vid').value;
        const file = document.getElementById('edit-file').files[0];
        
        const finalize = () => {
            localStorage.setItem(CONFIG.KEY, JSON.stringify(state.pages));
            render();
            closeModals();
        };

        if (vid) { p.vid = vid; p.img = null; finalize(); }
        else if (file) {
            const r = new FileReader();
            r.onload = (evt) => { p.img = evt.target.result; p.vid = null; finalize(); };
            if(file.size > 1000000) { alert("Image too big (Max 1MB)"); return; }
            r.readAsDataURL(file);
        } else { finalize(); }
    };
}

function openModal(id) {
    document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}
function closeModals() {
    document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
}

window.onload = init;
</script>
</body>
</html>